<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>微气候 - A microclimate can be something so small</title>
    <meta name="description" content="3分钟独处恢复体验，给职场人一个安静的恢复空间">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 首页 - 状态选择 -->
    <div id="home-page" class="page active">
        <div class="container">
            <main class="main-content">
                <div class="artistic-header">
                    <h1 class="cosmic-title">微气候</h1>
                    <p class="cosmic-subtitle">给自己3分钟时间，创造一个安静的恢复空间</p>
                </div>
                
                <div class="state-selection">
                    <h2 class="cosmic-question">你现在感觉怎么样？</h2>
                    <div class="state-options">
                        <button class="state-option" data-state="great">
                            <span class="emoji">😊</span>
                            <span class="label">很好</span>
                        </button>
                        <button class="state-option" data-state="okay">
                            <span class="emoji">😐</span>
                            <span class="label">还行</span>
                        </button>
                        <button class="state-option" data-state="tired">
                            <span class="emoji">😔</span>
                            <span class="label">有点累</span>
                        </button>
                        <button class="state-option" data-state="very-tired">
                            <span class="emoji">😩</span>
                            <span class="label">很累</span>
                        </button>
                        <button class="state-option" data-state="exhausted">
                            <span class="emoji">🤯</span>
                            <span class="label">崩溃</span>
                        </button>
                    </div>
                </div>
                
                <div class="action-section">
                    <button id="start-btn" class="primary-btn" disabled>
                        开始3分钟呼吸RESET
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- 恢复体验页 -->
    <div id="experience-page" class="page">
        <div class="container">
            <button id="back-btn" class="cosmic-back-btn">←</button>
            
            <main class="main-content">
                <div class="cosmic-experience-title">
                    <h1 class="experience-title">呼吸RESET</h1>
                    <div class="timer-display-small">
                        <span id="timer">03:00</span>
                    </div>
                    <div class="intro-text" id="intro-text">
                        让我们开始使用最有效的快速平静技术
                    </div>
                </div>
                
                <div class="cosmic-timer-section">
                    <div class="breathing-container">
                        <div class="breathing-circle" id="breathing-circle">
                            <div class="breathing-text" id="breathing-text">深呼吸...</div>
                        </div>

                    </div>
                </div>
                
                <div class="audio-section">
                    <div class="audio-controls">
                        <button class="audio-btn" data-audio="birds">
                            <span class="audio-icon">🐦</span>
                            <span class="audio-label">鸟声</span>
                        </button>
                        <button class="audio-btn" data-audio="rain">
                            <span class="audio-icon">🌧️</span>
                            <span class="audio-label">雨声</span>
                        </button>
                        <button class="audio-btn" data-audio="heartbeat">
                            <span class="audio-icon">💓</span>
                            <span class="audio-label">心跳声</span>
                        </button>
                        <button class="audio-btn" data-audio="waves">
                            <span class="audio-icon">🌊</span>
                            <span class="audio-label">海浪声</span>
                        </button>
                        <button class="audio-btn" data-audio="none">
                            <span class="audio-icon">🔇</span>
                            <span class="audio-label">静音</span>
                        </button>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <p>*斯坦福大学实验证明：环形叹息是最有效的呼吸技术，相比箱式呼吸和过度换气，在情绪改善和呼吸频率降低方面优势明显，甚至超过正念冥想。</p>
                </div>
                
                <div class="control-section">
                    <button id="pause-btn" class="control-btn">暂停</button>
                    <button id="restart-btn" class="control-btn">重新开始</button>
                    <button id="end-early-btn" class="control-btn end-early">提前结束</button>
                </div>
            </main>
        </div>
    </div>

    <!-- 完成反馈页 -->
    <div id="feedback-page" class="page">
        <div class="container">
            <main class="main-content">
                <div class="cosmic-completion">
                    <div class="completion-icon">✨</div>
                    <h2 class="completion-title">恭喜你完成了3分钟呼吸RESET</h2>
                    <p class="completion-text">希望这短暂的时光能为你带来一些宁静</p>
                </div>
                
                <div class="feedback-section">
                    <h3 class="feedback-title">你的反馈意见</h3>
                    
                    <div class="typeform-container">
                        <iframe 
                            src="https://form.typeform.com/to/aEpM3HIJ" 
                            width="100%" 
                            height="500px" 
                            frameborder="0" 
                            style="border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        </iframe>
                    </div>
                </div>
                
                <div class="restart-section">
                    <button id="restart-experience-btn" class="secondary-btn">再来一次</button>
                </div>
            </main>
        </div>
    </div>

    <!-- 音频元素 -->
    <audio id="birds-audio" preload="auto" loop>
        <source src="audio/spring-birds-in-a-summer-loop-195105.mp3" type="audio/mpeg">
    </audio>
    <audio id="rain-audio" preload="auto" loop>
        <source src="audio/heavy-rain-white-noise-159772.mp3" type="audio/mpeg">
    </audio>
    <audio id="heartbeat-audio" preload="auto" loop>
        <source src="audio/heartbeat-241465.mp3" type="audio/mpeg">
    </audio>
    <audio id="waves-audio" preload="auto" loop>
        <source src="audio/ocean-sea-soft-waves-121349.mp3" type="audio/mpeg">
    </audio>

    <!-- JavaScript -->
    <script src="typeform-config.js"></script>
    <script src="script.js"></script>
    
    <!-- Vercel Analytics -->
    <script>
        // 初始化 Vercel Analytics
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <!-- Vercel Speed Insights -->
    <script>
        window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
    
    <!-- 数据看板 -->
    <div id="adminPanel" style="display:none; position:fixed; top:10px; right:10px; background:white; padding:15px; border:2px solid #333; border-radius:8px; z-index:9999; max-width:320px; font-size:14px; color:#333; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
        <h4 style="margin:0 0 10px 0; color:#333;">数据看板 📊</h4>
        <div id="statsDisplay" style="color:#333;"></div>
        <button onclick="updateAdminPanel()" style="margin:5px; padding:8px 12px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">刷新</button>
        <button onclick="showDetailedData()" style="margin:5px; padding:8px 12px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer;">详细数据</button>
        <button onclick="closeAdmin()" style="margin:5px; padding:8px 12px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">关闭</button>
    </div>
    
    <!-- 详细数据面板 -->
    <div id="detailPanel" style="display:none; position:fixed; top:10px; left:10px; background:white; padding:20px; border:2px solid #333; border-radius:8px; z-index:9999; max-width:600px; max-height:80vh; overflow-y:auto; font-size:14px; color:#333; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
        <h4 style="margin:0 0 15px 0; color:#333;">详细数据 📋</h4>
        <div id="detailDisplay" style="color:#333;"></div>
        <button onclick="closeDetailPanel()" style="margin:10px 5px 0 0; padding:8px 12px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">关闭</button>
    </div>

    <script>
        // 按 Ctrl+Shift+D 显示数据看板
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                document.getElementById('adminPanel').style.display = 'block';
                updateAdminPanel();
            }
        });

        function updateAdminPanel() {
            const stats = JSON.parse(localStorage.getItem('microclimatStats') || '{}');
            const timeData = analyzeTimePatterns();

            document.getElementById('statsDisplay').innerHTML = `
                <p><strong>核心转化率：</strong></p>
                <p>完成率: ${stats.experienceStarted ? (stats.experienceCompleted/stats.experienceStarted*100).toFixed(1) : 0}%</p>
                <p>状态选择率: ${stats.pageViews ? (stats.stateSelected/stats.pageViews*100).toFixed(1) : 0}%</p>
                <p><strong>使用数据：</strong></p>
                <p>总访问: ${stats.pageViews || 0}</p>
                <p>完成体验: ${stats.experienceCompleted || 0}</p>
                <p>反馈数: ${stats.feedbackSubmitted || 0}</p>
                <p><strong>时间分析：</strong></p>
                <p>晚间使用率: ${timeData ? timeData.eveningRate : 0}%</p>
                <p>总事件: ${timeData ? timeData.totalEvents : 0}</p>
                <p><small>按 Ctrl+Shift+D 打开此面板</small></p>
            `;
        }
        
        function showDetailedData() {
            const stats = JSON.parse(localStorage.getItem('microclimatStats') || '{}');
            const events = JSON.parse(localStorage.getItem('microclimatEvents') || '[]');
            const timeData = analyzeTimePatterns();
            
            // 按小时分组显示
            let hourlyBreakdown = '';
            if (timeData && timeData.hourlyUse) {
                hourlyBreakdown = '<p><strong>每小时使用分布：</strong></p>';
                for (let hour = 0; hour < 24; hour++) {
                    const count = timeData.hourlyUse[hour] || 0;
                    if (count > 0) {
                        hourlyBreakdown += `<p>${hour}:00-${hour}:59: ${count}次</p>`;
                    }
                }
            }
            
            // 最近事件列表
            let recentEvents = '<p><strong>最近10个事件：</strong></p>';
            const recent = events.slice(-10).reverse();
            recent.forEach(event => {
                const time = new Date(event.timestamp).toLocaleString('zh-CN');
                recentEvents += `<p style="margin:2px 0; padding:2px; background:#f5f5f5;">${time} - ${event.eventName}</p>`;
            });
            
            // 详细统计
            const detailStats = `
                <p><strong>详细统计数据：</strong></p>
                <p>页面访问: ${stats.pageViews || 0}</p>
                <p>状态选择: ${stats.stateSelected || 0}</p>
                <p>体验开始: ${stats.experienceStarted || 0}</p>
                <p>体验完成: ${stats.experienceCompleted || 0}</p>
                <p>音频播放: ${stats.audioPlayed || 0}</p>
                <p>反馈提交: ${stats.feedbackSubmitted || 0}</p>
                <p>总事件数: ${events.length}</p>
            `;
            
            document.getElementById('detailDisplay').innerHTML = detailStats + hourlyBreakdown + recentEvents;
            document.getElementById('detailPanel').style.display = 'block';
        }
        
        function closeDetailPanel() {
            document.getElementById('detailPanel').style.display = 'none';
        }

        function closeAdmin() {
            document.getElementById('adminPanel').style.display = 'none';
        }
    </script>
</body>
</html>
