<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>å¾®æ°”å€™ - A microclimate can be something so small</title>
    <meta name="description" content="3åˆ†é’Ÿç‹¬å¤„æ¢å¤ä½“éªŒï¼Œç»™èŒåœºäººä¸€ä¸ªå®‰é™çš„æ¢å¤ç©ºé—´">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- é¦–é¡µ - çŠ¶æ€é€‰æ‹© -->
    <div id="home-page" class="page active">
        <div class="container">
            <main class="main-content">
                <div class="artistic-header">
                    <h1 class="cosmic-title">å¾®æ°”å€™</h1>
                    <p class="cosmic-subtitle">ç»™è‡ªå·±3åˆ†é’Ÿæ—¶é—´ï¼Œåˆ›é€ ä¸€ä¸ªå®‰é™çš„æ¢å¤ç©ºé—´</p>
                </div>
                
                <div class="state-selection">
                    <h2 class="cosmic-question">ä½ ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ</h2>
                    <div class="state-options">
                        <button class="state-option" data-state="great">
                            <span class="emoji">ğŸ˜Š</span>
                            <span class="label">å¾ˆå¥½</span>
                        </button>
                        <button class="state-option" data-state="okay">
                            <span class="emoji">ğŸ˜</span>
                            <span class="label">è¿˜è¡Œ</span>
                        </button>
                        <button class="state-option" data-state="tired">
                            <span class="emoji">ğŸ˜”</span>
                            <span class="label">æœ‰ç‚¹ç´¯</span>
                        </button>
                        <button class="state-option" data-state="very-tired">
                            <span class="emoji">ğŸ˜©</span>
                            <span class="label">å¾ˆç´¯</span>
                        </button>
                        <button class="state-option" data-state="exhausted">
                            <span class="emoji">ğŸ¤¯</span>
                            <span class="label">å´©æºƒ</span>
                        </button>
                    </div>
                </div>
                
                <div class="action-section">
                    <button id="start-btn" class="primary-btn" disabled>
                        å¼€å§‹3åˆ†é’Ÿå‘¼å¸RESET
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- æ¢å¤ä½“éªŒé¡µ -->
    <div id="experience-page" class="page">
        <div class="container">
            <button id="back-btn" class="cosmic-back-btn">â†</button>
            
            <main class="main-content">
                <div class="cosmic-experience-title">
                    <h1 class="experience-title">å‘¼å¸RESET</h1>
                    <div class="timer-display-small">
                        <span id="timer">03:00</span>
                    </div>
                    <div class="intro-text" id="intro-text">
                        è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨æœ€æœ‰æ•ˆçš„å¿«é€Ÿå¹³é™æŠ€æœ¯
                    </div>
                </div>
                
                <div class="cosmic-timer-section">
                    <div class="breathing-container">
                        <div class="breathing-circle" id="breathing-circle">
                            <div class="breathing-text" id="breathing-text">æ·±å‘¼å¸...</div>
                        </div>

                    </div>
                </div>
                
                <div class="audio-section">
                    <div class="audio-controls">
                        <button class="audio-btn" data-audio="birds">
                            <span class="audio-icon">ğŸ¦</span>
                            <span class="audio-label">é¸Ÿå£°</span>
                        </button>
                        <button class="audio-btn" data-audio="rain">
                            <span class="audio-icon">ğŸŒ§ï¸</span>
                            <span class="audio-label">é›¨å£°</span>
                        </button>
                        <button class="audio-btn" data-audio="heartbeat">
                            <span class="audio-icon">ğŸ’“</span>
                            <span class="audio-label">å¿ƒè·³å£°</span>
                        </button>
                        <button class="audio-btn" data-audio="waves">
                            <span class="audio-icon">ğŸŒŠ</span>
                            <span class="audio-label">æµ·æµªå£°</span>
                        </button>
                        <button class="audio-btn" data-audio="none">
                            <span class="audio-icon">ğŸ”‡</span>
                            <span class="audio-label">é™éŸ³</span>
                        </button>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <p>*æ–¯å¦ç¦å¤§å­¦å®éªŒè¯æ˜ï¼šç¯å½¢å¹æ¯æ˜¯æœ€æœ‰æ•ˆçš„å‘¼å¸æŠ€æœ¯ï¼Œç›¸æ¯”ç®±å¼å‘¼å¸å’Œè¿‡åº¦æ¢æ°”ï¼Œåœ¨æƒ…ç»ªæ”¹å–„å’Œå‘¼å¸é¢‘ç‡é™ä½æ–¹é¢ä¼˜åŠ¿æ˜æ˜¾ï¼Œç”šè‡³è¶…è¿‡æ­£å¿µå†¥æƒ³ã€‚</p>
                </div>
                
                <div class="control-section">
                    <button id="pause-btn" class="control-btn">æš‚åœ</button>
                    <button id="restart-btn" class="control-btn">é‡æ–°å¼€å§‹</button>
                    <button id="end-early-btn" class="control-btn end-early">æå‰ç»“æŸ</button>
                </div>
            </main>
        </div>
    </div>

    <!-- å®Œæˆåé¦ˆé¡µ -->
    <div id="feedback-page" class="page">
        <div class="container">
            <main class="main-content">
                <div class="cosmic-completion">
                    <div class="completion-icon">âœ¨</div>
                    <h2 class="completion-title">æ­å–œä½ å®Œæˆäº†3åˆ†é’Ÿå‘¼å¸RESET</h2>
                    <p class="completion-text">å¸Œæœ›è¿™çŸ­æš‚çš„æ—¶å…‰èƒ½ä¸ºä½ å¸¦æ¥ä¸€äº›å®é™</p>
                </div>
                
                <div class="feedback-section">
                    <h3 class="feedback-title">ä½ çš„åé¦ˆæ„è§</h3>
                    
                    <div class="typeform-container">
                        <iframe 
                            src="https://form.typeform.com/to/aEpM3HIJ" 
                            width="100%" 
                            height="500px" 
                            frameborder="0" 
                            style="border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        </iframe>
                    </div>
                </div>
                
                <div class="restart-section">
                    <button id="restart-experience-btn" class="secondary-btn">å†æ¥ä¸€æ¬¡</button>
                </div>
            </main>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="birds-audio" preload="auto" loop>
        <source src="audio/spring-birds-in-a-summer-loop-195105.mp3" type="audio/mpeg">
    </audio>
    <audio id="rain-audio" preload="auto" loop>
        <source src="audio/heavy-rain-white-noise-159772.mp3" type="audio/mpeg">
    </audio>
    <audio id="heartbeat-audio" preload="auto" loop>
        <source src="audio/heartbeat-241465.mp3" type="audio/mpeg">
    </audio>
    <audio id="waves-audio" preload="auto" loop>
        <source src="audio/ocean-sea-soft-waves-121349.mp3" type="audio/mpeg">
    </audio>

    <!-- JavaScript -->
    <script src="typeform-config.js"></script>
    <script src="script.js"></script>
    
    <!-- Vercel Analytics -->
    <script>
        // åˆå§‹åŒ– Vercel Analytics
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <!-- Vercel Speed Insights -->
    <script>
        window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
    
    <!-- æ•°æ®çœ‹æ¿ -->
    <div id="adminPanel" style="display:none; position:fixed; top:10px; right:10px; background:white; padding:15px; border:2px solid #333; border-radius:8px; z-index:9999; max-width:320px; font-size:14px; color:#333; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
        <h4 style="margin:0 0 10px 0; color:#333;">æ•°æ®çœ‹æ¿ ğŸ“Š</h4>
        <div id="statsDisplay" style="color:#333;"></div>
        <button onclick="updateAdminPanel()" style="margin:5px; padding:8px 12px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">åˆ·æ–°</button>
        <button onclick="showDetailedData()" style="margin:5px; padding:8px 12px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer;">è¯¦ç»†æ•°æ®</button>
        <button onclick="closeAdmin()" style="margin:5px; padding:8px 12px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">å…³é—­</button>
    </div>
    
    <!-- è¯¦ç»†æ•°æ®é¢æ¿ -->
    <div id="detailPanel" style="display:none; position:fixed; top:10px; left:10px; background:white; padding:20px; border:2px solid #333; border-radius:8px; z-index:9999; max-width:600px; max-height:80vh; overflow-y:auto; font-size:14px; color:#333; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
        <h4 style="margin:0 0 15px 0; color:#333;">è¯¦ç»†æ•°æ® ğŸ“‹</h4>
        <div id="detailDisplay" style="color:#333;"></div>
        <button onclick="closeDetailPanel()" style="margin:10px 5px 0 0; padding:8px 12px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">å…³é—­</button>
    </div>

    <script>
        // æŒ‰ Ctrl+Shift+D æ˜¾ç¤ºæ•°æ®çœ‹æ¿
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                document.getElementById('adminPanel').style.display = 'block';
                updateAdminPanel();
            }
        });

        function updateAdminPanel() {
            const stats = JSON.parse(localStorage.getItem('microclimatStats') || '{}');
            const timeData = analyzeTimePatterns();

            document.getElementById('statsDisplay').innerHTML = `
                <p><strong>æ ¸å¿ƒè½¬åŒ–ç‡ï¼š</strong></p>
                <p>å®Œæˆç‡: ${stats.experienceStarted ? (stats.experienceCompleted/stats.experienceStarted*100).toFixed(1) : 0}%</p>
                <p>çŠ¶æ€é€‰æ‹©ç‡: ${stats.pageViews ? (stats.stateSelected/stats.pageViews*100).toFixed(1) : 0}%</p>
                <p><strong>ä½¿ç”¨æ•°æ®ï¼š</strong></p>
                <p>æ€»è®¿é—®: ${stats.pageViews || 0}</p>
                <p>å®Œæˆä½“éªŒ: ${stats.experienceCompleted || 0}</p>
                <p>åé¦ˆæ•°: ${stats.feedbackSubmitted || 0}</p>
                <p><strong>æ—¶é—´åˆ†æï¼š</strong></p>
                <p>æ™šé—´ä½¿ç”¨ç‡: ${timeData ? timeData.eveningRate : 0}%</p>
                <p>æ€»äº‹ä»¶: ${timeData ? timeData.totalEvents : 0}</p>
                <p><small>æŒ‰ Ctrl+Shift+D æ‰“å¼€æ­¤é¢æ¿</small></p>
            `;
        }
        
        function showDetailedData() {
            const stats = JSON.parse(localStorage.getItem('microclimatStats') || '{}');
            const events = JSON.parse(localStorage.getItem('microclimatEvents') || '[]');
            const timeData = analyzeTimePatterns();
            
            // æŒ‰å°æ—¶åˆ†ç»„æ˜¾ç¤º
            let hourlyBreakdown = '';
            if (timeData && timeData.hourlyUse) {
                hourlyBreakdown = '<p><strong>æ¯å°æ—¶ä½¿ç”¨åˆ†å¸ƒï¼š</strong></p>';
                for (let hour = 0; hour < 24; hour++) {
                    const count = timeData.hourlyUse[hour] || 0;
                    if (count > 0) {
                        hourlyBreakdown += `<p>${hour}:00-${hour}:59: ${count}æ¬¡</p>`;
                    }
                }
            }
            
            // æœ€è¿‘äº‹ä»¶åˆ—è¡¨
            let recentEvents = '<p><strong>æœ€è¿‘10ä¸ªäº‹ä»¶ï¼š</strong></p>';
            const recent = events.slice(-10).reverse();
            recent.forEach(event => {
                const time = new Date(event.timestamp).toLocaleString('zh-CN');
                recentEvents += `<p style="margin:2px 0; padding:2px; background:#f5f5f5;">${time} - ${event.eventName}</p>`;
            });
            
            // è¯¦ç»†ç»Ÿè®¡
            const detailStats = `
                <p><strong>è¯¦ç»†ç»Ÿè®¡æ•°æ®ï¼š</strong></p>
                <p>é¡µé¢è®¿é—®: ${stats.pageViews || 0}</p>
                <p>çŠ¶æ€é€‰æ‹©: ${stats.stateSelected || 0}</p>
                <p>ä½“éªŒå¼€å§‹: ${stats.experienceStarted || 0}</p>
                <p>ä½“éªŒå®Œæˆ: ${stats.experienceCompleted || 0}</p>
                <p>éŸ³é¢‘æ’­æ”¾: ${stats.audioPlayed || 0}</p>
                <p>åé¦ˆæäº¤: ${stats.feedbackSubmitted || 0}</p>
                <p>æ€»äº‹ä»¶æ•°: ${events.length}</p>
            `;
            
            document.getElementById('detailDisplay').innerHTML = detailStats + hourlyBreakdown + recentEvents;
            document.getElementById('detailPanel').style.display = 'block';
        }
        
        function closeDetailPanel() {
            document.getElementById('detailPanel').style.display = 'none';
        }

        function closeAdmin() {
            document.getElementById('adminPanel').style.display = 'none';
        }
    </script>
</body>
</html>
